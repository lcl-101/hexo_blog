<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                <% if (config.RSS) { %>
                    <li>
                        <a href="<%= config.root + 'feed.xml' %>">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                <% } %>
                <% if (config.twitter_username) { %>
                    <li>
                        <a target="_blank" href="https://twitter.com/<%= config.twitter_username %>">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                <% } %>
                <% if (config.zhihu_username) { %>
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/<%= config.zhihu_username %>">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                <% } %>

                <% if (config.weibo_username) { %>
                    <li>
                        <a target="_blank" href="http://weibo.com/<%= config.weibo_username %>">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                <% } %>

                <% if (config.facebook_username) { %>
                    <li>
                        <a target="_blank" href="https://www.facebook.com/<%= config.facebook_username %>">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                <% } %>

                <% if (config.github_username) { %>
                    <li>
                        <a target="_blank"  href="https://github.com/<%= config.github_username %>">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                <% } %>

                <% if (config.linkedin_username) { %>
                    <li>
                        <a target="_blank"  href="https://www.linkedin.com/in/<%= config.linkedin_username %>">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                <% } %>

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; <%= config.author %> <%= new Date().getFullYear() %>
                </p>
            </div>
        </div>
    </div>
</footer>

<div style="display:none;">
  <iframe src="" width="200" height="200" id="myframe"></iframe>
</div>

<!-- jQuery -->
<%- js('js/jquery.min.js') %>

<!-- Bootstrap Core JavaScript -->
<%- js('js/bootstrap.min.js') %>

<!-- Custom Theme JavaScript -->
<%- js('js/hux-blog.min.js') %>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("<%= config.url%><%= config.root%>js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<% if (config.ga_track_id) { %>
<script>
    // dynamic User by Hux
    var _gaId = '{{ site.ga_track_id }}';
    var _gaDomain = '{{ site.ga_domain }}';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>
<% } %>


<!-- Baidu Tongji -->
<% if (config.ba_track_id) { %>
<script>
    // dynamic User by Hux
    var _baId = '{{ site.ba_track_id }}';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>
<% } %>

<script type="text/javascript">
$(function(){
  //changeURL 页面不刷新
  var changeURL = function(){
    var ajax = new XMLHttpRequest();
    var state = {
      title: document.title,
      url: window.location.href,
      content: $('#page_content').html()
    };

    // 调用数据回掉函数
  	var ajaxCallback = function(){
  		if(ajax.readyState == 4){
  			// push到历史记录里，可以在点击后退时从历史记录里恢复内容
  			// 并且无刷修改url地址
        console.log(ajax.responseURL)

        var contestHtml = $('#page_content').hide().html(ajax.response).find('#page_content').html();
        $('body').find('#ProgressBar').find('svg').remove();
        state.content = contestHtml;

        // iframeLoad(state,function(res){
        //   window.history.pushState(res,document.title,res.url);
        //   $(window).scrollTop(0);
        //   $('#page_content').html(window.frames['myframe'].contentWindow.document.getElementById("page_content").innerHTML);
        //   NProgress.done();
        // });

        window.history.pushState(state,document.title,ajax.responseURL);
        $('#page_content').html(contestHtml).show();
  		}
  	};
    // 点击事件
    $('#body').delegate('a', 'click', function(event) {
      if(window.location.href == event.target.href){return false;};
      NProgress.start();
      state.title = document.title;
      state.url = event.target.href;
      ajax.open('GET',state.url, true);
  		ajax.onreadystatechange = ajaxCallback;
  		ajax.send('');
      NProgress.done();
      return false;
    });

    // 记录到历史里，当点击后退按钮还退回上次页面请求前的页面内容
    window.onpopstate = function(){
      console.log(history)
      $('#page_content').html(history.state.content);
    }

    // 修改当前页面在 history 中的记录
    window.history.replaceState(state,document.title,state.url);
    NProgress.done();
  };

  // 检测是否支持
  try{
    //监听事件
    window.addEventListener('DOMContentLoaded', changeURL, false);
  }catch(e){
    console.log('浏览器不支持，请使用支持html5的浏览器');
  }


  function iframeLoad(state,fn){
    var iframe = document.getElementById("myframe");
    iframe.contentWindow.location.replace(state.url);   //不会产生历史记录
    if (iframe.attachEvent){
      iframe.attachEvent("onload", function(){
        // alert("Local iframe is now loaded.");
        state.content=window.frames['myframe'].contentWindow.document.getElementById("page_content").innerHTML;
        if(fn){fn(state)};
      });
    } else {
      iframe.onload = function(){
        // alert("Local iframe is now loaded.");
        state.content=window.frames['myframe'].contentWindow.document.getElementById("page_content").innerHTML;
        if(fn){fn(state)};
      };
    }
  }
})
</script>
